
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pwilkin.github.io/grizabella/api/mcp_server/">
      
      
        <link rel="prev" href="../client/">
      
      
        <link rel="next" href="../../troubleshooting_faq/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>MCP Server - Grizabella</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mcp-server" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Grizabella" class="md-header__button md-logo" aria-label="Grizabella" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Grizabella
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MCP Server
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/pwilkin/grizabella" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pwilkin/grizabella
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Grizabella" class="md-nav__button md-logo" aria-label="Grizabella" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Grizabella
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pwilkin/grizabella" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    pwilkin/grizabella
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core_concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python_api_detailed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python API Detailed Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp_server_api_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MCP Server API Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyside6_ui_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PySide6 UI Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    MCP Server
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    MCP Server
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#grizabella.mcp.server" class="md-nav__link">
    <span class="md-ellipsis">
      server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.cleanup_resources" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup_resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.get_grizabella_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_grizabella_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.get_grizabella_db_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_grizabella_db_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.log_tool_call" class="md-nav__link">
    <span class="md-ellipsis">
      log_tool_call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_find_objects" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_find_objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_get_embedding_vector_for_text" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_get_embedding_vector_for_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_get_incoming_relations" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_get_incoming_relations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_get_outgoing_relations" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_get_outgoing_relations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_search_similar_objects" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_search_similar_objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.shutdown_handler" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown_handler
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting_faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting & FAQ
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#grizabella.mcp.server" class="md-nav__link">
    <span class="md-ellipsis">
      server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.cleanup_resources" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup_resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.get_grizabella_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_grizabella_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.get_grizabella_db_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_grizabella_db_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.log_tool_call" class="md-nav__link">
    <span class="md-ellipsis">
      log_tool_call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_find_objects" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_find_objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_get_embedding_vector_for_text" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_get_embedding_vector_for_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_get_incoming_relations" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_get_incoming_relations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_get_outgoing_relations" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_get_outgoing_relations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.mcp_search_similar_objects" class="md-nav__link">
    <span class="md-ellipsis">
      mcp_search_similar_objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grizabella.mcp.server.shutdown_handler" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown_handler
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mcp-server">MCP Server</h1>


<div class="doc doc-object doc-module">



<h2 id="grizabella.mcp.server" class="doc doc-heading">
            <code>grizabella.mcp.server</code>


</h2>

    <div class="doc doc-contents first">

      <p>Grizabella MCP Server.</p>
<p>This module provides an MCP (Model Context Protocol) server for Grizabella,
exposing its core functionalities as tools that can be called remotely.
It uses FastMCP to define and serve these tools.</p>
<p>Server Description: This MCP server exposes the core functionalities of the Grizabella
knowledge management system, allowing for the creation, retrieval, and querying of
structured data objects and their relationships.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.cleanup_resources" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cleanup_resources</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Perform cleanup of all resources.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cleanup_resources</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform cleanup of all resources.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting resource cleanup...&quot;</span><span class="p">)</span>

    <span class="c1"># Clean up database connections using the global singleton</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">grizabella.core.connection_pool</span><span class="w"> </span><span class="kn">import</span> <span class="n">cleanup_global_connection_pool</span><span class="p">,</span> <span class="n">get_connection_pool_manager</span>
        <span class="c1"># First try to get the global instance and clean it up</span>
        <span class="n">pool_manager</span> <span class="o">=</span> <span class="n">get_connection_pool_manager</span><span class="p">()</span>
        <span class="n">pool_manager</span><span class="o">.</span><span class="n">close_all_pools</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection pools closed via global manager&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing connection pools: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Try alternative approach - direct cleanup</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">grizabella.core.connection_pool</span><span class="w"> </span><span class="kn">import</span> <span class="n">cleanup_global_connection_pool</span>
            <span class="n">cleanup_global_connection_pool</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection pools cleaned up via global cleanup function&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error with global pool cleanup: </span><span class="si">{</span><span class="n">e2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Last resort - try creating a new instance and cleaning it up</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pool_manager</span> <span class="o">=</span> <span class="n">ConnectionPoolManager</span><span class="p">()</span>
                <span class="n">pool_manager</span><span class="o">.</span><span class="n">close_all_pools</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection pools closed via alternative method&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e3</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error with alternative pool cleanup: </span><span class="si">{</span><span class="n">e3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Clean up DB managers</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cleanup_all_managers</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;DB managers cleaned up&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error cleaning up DB managers: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Stop monitoring</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">stop_global_monitoring</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resource monitoring stopped&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error stopping resource monitoring: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Force garbage collection</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
        <span class="n">collected</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Garbage collector cleaned up </span><span class="si">{</span><span class="n">collected</span><span class="si">}</span><span class="s2"> objects&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during garbage collection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resource cleanup completed&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.get_grizabella_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_grizabella_client</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the shared Grizabella client instance.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_grizabella_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Grizabella</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the shared Grizabella client instance.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">grizabella_client_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="s2">&quot;Grizabella client is not initialized.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grizabella_client_instance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.get_grizabella_db_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_grizabella_db_path</span><span class="p">(</span><span class="n">db_path_arg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Determines the database path from arg, env var, or default.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_grizabella_db_path</span><span class="p">(</span><span class="n">db_path_arg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines the database path from arg, env var, or default.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">db_path_arg</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">db_path_arg</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">GRIZABELLA_DB_PATH_ENV_VAR</span><span class="p">,</span> <span class="n">DEFAULT_GRIZABELLA_DB_PATH</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.log_tool_call" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">log_tool_call</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Decorator to log detailed information about tool calls.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">log_tool_call</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to log detailed information about tool calls.&quot;&quot;&quot;</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Extract tool name from function name (remove mcp_ prefix)</span>
        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">tool_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;mcp_&#39;</span><span class="p">):</span>
            <span class="n">tool_name</span> <span class="o">=</span> <span class="n">tool_name</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>

        <span class="c1"># Log the tool call with details</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîß Tool Call: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Log arguments if any (excluding &#39;self&#39; for methods)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># Skip &#39;self&#39; argument for methods</span>
            <span class="n">actual_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;__class__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">args</span>
            <span class="k">if</span> <span class="n">actual_args</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìù Arguments: </span><span class="si">{</span><span class="n">actual_args</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìù Keyword Arguments: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Call the original function</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ Tool Call Success: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Tool Call Failed: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2"> - Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Initializes client and runs the FastMCP application.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes client and runs the FastMCP application.&quot;&quot;&quot;</span>
    <span class="c1"># Register signal handlers</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">shutdown_handler</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">shutdown_handler</span><span class="p">)</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Grizabella MCP Server&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--db-path&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to the Grizabella database.&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">global</span> <span class="n">grizabella_client_instance</span>
    <span class="n">db_path</span> <span class="o">=</span> <span class="n">get_grizabella_db_path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Grizabella</span><span class="p">(</span><span class="n">db_name_or_path</span><span class="o">=</span><span class="n">db_path</span><span class="p">,</span> <span class="n">create_if_not_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">gb</span><span class="p">:</span>
            <span class="n">grizabella_client_instance</span> <span class="o">=</span> <span class="n">gb</span>
            <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">show_banner</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Ensure clean termination</span>
        <span class="n">grizabella_client_instance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cleanup_resources</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server terminated cleanly&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.mcp_find_objects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mcp_find_objects</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">filter_criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Finds and retrieves a list of objects of a given type, with optional filtering criteria.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;find_objects&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;Finds and retrieves a list of objects of a given type, with optional filtering criteria.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Example:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;To find all &#39;Person&#39; objects where the age is greater than 30:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &quot;args&quot;: {</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;type_name&quot;: &quot;Person&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;filter_criteria&quot;: {</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;      &quot;age&quot;: {&quot;&gt;&quot;: 30}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    },</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;limit&quot;: 10</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  }</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;}&#39;</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_find_objects</span><span class="p">(</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filter_criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ObjectInstance</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds and retrieves a list of objects of a given type, with optional filtering criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ctx: ToolContext,</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gb</span> <span class="o">=</span> <span class="n">get_grizabella_client</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">gb</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span>
            <span class="n">filter_criteria</span><span class="o">=</span><span class="n">filter_criteria</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">GrizabellaException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: Error finding objects of type &#39;</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: Unexpected error finding objects of type &#39;</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.mcp_get_embedding_vector_for_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mcp_get_embedding_vector_for_text</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Generates an embedding vector for a given text using a specified embedding definition.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;get_embedding_vector_for_text&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Generates an embedding vector for a given text using a specified embedding definition.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@log_tool_call</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_get_embedding_vector_for_text</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">GetEmbeddingVectorForTextArgs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmbeddingVector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates an embedding vector for a given text using a specified embedding definition.&quot;&quot;&quot;</span>
    <span class="n">gb</span> <span class="o">=</span> <span class="n">get_grizabella_client</span><span class="p">()</span>
    <span class="n">embedding_def</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">get_embedding_definition</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">embedding_definition_name</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 1. Get the embedding definition</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">embedding_def</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Embedding definition &#39;</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">embedding_definition_name</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>

        <span class="c1"># 2. Generate embedding vector directly using the same logic as find_similar_objects_by_embedding</span>
        <span class="c1"># This approach mirrors the Python client&#39;s successful method</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating embedding vector for text using model &#39;</span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">embedding_model</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Get the embedding model function</span>
        <span class="c1"># Strip &#39;huggingface/&#39; prefix if present, as LanceDB registry expects just the model name</span>
        <span class="n">model_identifier</span> <span class="o">=</span> <span class="n">embedding_def</span><span class="o">.</span><span class="n">embedding_model</span>
        <span class="k">if</span> <span class="n">model_identifier</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;huggingface/&#39;</span><span class="p">):</span>
            <span class="n">model_identifier</span> <span class="o">=</span> <span class="n">model_identifier</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;huggingface/&#39;</span><span class="p">):]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stripped &#39;huggingface/&#39; prefix from model identifier: &#39;</span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">embedding_model</span><span class="si">}</span><span class="s2">&#39; -&gt; &#39;</span><span class="si">{</span><span class="n">model_identifier</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;About to load embedding model with identifier: &#39;</span><span class="si">{</span><span class="n">model_identifier</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">embedding_model_func</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">_db_manager</span><span class="o">.</span><span class="n">_connection_helper</span><span class="o">.</span><span class="n">lancedb_adapter</span><span class="o">.</span><span class="n">get_embedding_model</span><span class="p">(</span>
            <span class="n">model_identifier</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Generate embedding using compute_query_embeddings (same as Python client)</span>
        <span class="n">raw_query_embeddings</span> <span class="o">=</span> <span class="n">embedding_model_func</span><span class="o">.</span><span class="n">compute_query_embeddings</span><span class="p">([</span><span class="n">args</span><span class="o">.</span><span class="n">text_to_embed</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw_query_embeddings</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model &#39;</span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">embedding_model</span><span class="si">}</span><span class="s2">&#39; returned empty list for text.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">embedding_model</span><span class="si">}</span><span class="s2"> returned empty list for text.&quot;</span><span class="p">)</span>

        <span class="n">raw_query_vector</span> <span class="o">=</span> <span class="n">raw_query_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Convert to list if it&#39;s a numpy array</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">raw_query_vector</span><span class="p">,</span> <span class="s2">&quot;tolist&quot;</span><span class="p">):</span>  <span class="c1"># Handles numpy array</span>
            <span class="n">final_query_vector</span> <span class="o">=</span> <span class="n">raw_query_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_query_vector</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">final_query_vector</span> <span class="o">=</span> <span class="n">raw_query_vector</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected query vector type from model &#39;</span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">embedding_model</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">raw_query_vector</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected query vector type from model </span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">embedding_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Validate dimensions (temporarily disabled for debugging)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated embedding vector with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">final_query_vector</span><span class="p">)</span><span class="si">}</span><span class="s2"> dimensions. ED specifies </span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">dimensions</span><span class="si">}</span><span class="s2"> dimensions.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">embedding_def</span><span class="o">.</span><span class="n">dimensions</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_query_vector</span><span class="p">)</span> <span class="o">!=</span> <span class="n">embedding_def</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Query vector dim (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">final_query_vector</span><span class="p">)</span><span class="si">}</span><span class="s2">) does not match ED &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; dim (</span><span class="si">{</span><span class="n">embedding_def</span><span class="o">.</span><span class="n">dimensions</span><span class="si">}</span><span class="s2">). Continuing anyway.&quot;</span>
            <span class="p">)</span>
            <span class="c1"># raise GrizabellaException(msg)  # Temporarily disabled</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated embedding vector with dimension </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">final_query_vector</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Debug: Log what we&#39;re about to return</span>
        <span class="n">debug_return_value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vector&quot;</span><span class="p">:</span> <span class="n">final_query_vector</span><span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCP get_embedding_vector_for_text returning: type=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">debug_return_value</span><span class="p">)</span><span class="si">}</span><span class="s2">, vector_type=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">debug_return_value</span><span class="p">[</span><span class="s1">&#39;vector&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">, vector_length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">debug_return_value</span><span class="p">[</span><span class="s1">&#39;vector&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCP get_embedding_vector_for_text return value preview: </span><span class="si">{</span><span class="n">debug_return_value</span><span class="p">[</span><span class="s1">&#39;vector&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="c1"># Return as a plain dict to ensure MCP serialization works correctly</span>
        <span class="k">return</span> <span class="n">debug_return_value</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate embedding vector: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate embedding vector: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.mcp_get_incoming_relations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mcp_get_incoming_relations</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">relation_type_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Retrieves all incoming relations to a specific object.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;get_incoming_relations&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;Retrieves all incoming relations to a specific object.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Example:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;To get all incoming relations to Jane Doe&#39;s &#39;Person&#39; object:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &quot;args&quot;: {</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;object_id&quot;: &quot;jane_doe_456&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;type_name&quot;: &quot;Person&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  }</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;}&#39;</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_get_incoming_relations</span><span class="p">(</span>
    <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation_type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RelationInstance</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves all incoming relations to a specific object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ctx: ToolContext,</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gb</span> <span class="o">=</span> <span class="n">get_grizabella_client</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">gb</span><span class="o">.</span><span class="n">get_incoming_relations</span><span class="p">(</span>
            <span class="n">object_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span>
            <span class="n">relation_type_name</span><span class="o">=</span><span class="n">relation_type_name</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">GrizabellaException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: Error getting incoming relations for object &#39;</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: Unexpected error getting incoming relations for object &#39;</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.mcp_get_outgoing_relations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mcp_get_outgoing_relations</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">relation_type_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Retrieves all outgoing relations from a specific object.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;get_outgoing_relations&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;Retrieves all outgoing relations from a specific object.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Example:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;To get all outgoing relations from John Doe&#39;s &#39;Person&#39; object:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &quot;args&quot;: {</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;object_id&quot;: &quot;john_doe_123&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;type_name&quot;: &quot;Person&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  }</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;}&#39;</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_get_outgoing_relations</span><span class="p">(</span>
    <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation_type_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RelationInstance</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves all outgoing relations from a specific object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ctx: ToolContext,</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gb</span> <span class="o">=</span> <span class="n">get_grizabella_client</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">gb</span><span class="o">.</span><span class="n">get_outgoing_relations</span><span class="p">(</span>
            <span class="n">object_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span>
            <span class="n">relation_type_name</span><span class="o">=</span><span class="n">relation_type_name</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">GrizabellaException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: Error getting outgoing relations for object &#39;</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: Unexpected error getting outgoing relations for object &#39;</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.mcp_search_similar_objects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mcp_search_similar_objects</span><span class="p">(</span><span class="n">object_id</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">n_results</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">search_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Searches for objects that are semantically similar to a given object, based on embeddings of their properties.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;search_similar_objects&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;Searches for objects that are semantically similar to a given object, based on embeddings &quot;</span>
        <span class="s2">&quot;of their properties. Note: This feature is not yet fully implemented.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Example:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;To find 5 objects similar to John Doe&#39;s &#39;Person&#39; object:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &quot;args&quot;: {</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;object_id&quot;: &quot;john_doe_123&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;type_name&quot;: &quot;Person&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &quot;n_results&quot;: 5</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  }</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;}&#39;</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_search_similar_objects</span><span class="p">(</span>
    <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">n_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">search_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ObjectInstance</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Searches for objects that are semantically similar to a given object, based on embeddings of their properties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ctx: ToolContext,</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gb</span> <span class="o">=</span> <span class="n">get_grizabella_client</span><span class="p">()</span>
        <span class="c1"># The Grizabella client&#39;s search_similar_objects currently raises NotImplementedError.</span>
        <span class="c1"># We must call it to respect the interface, but handle the expected error.</span>
        <span class="c1"># If it were implemented, results would be List[Tuple[ObjectInstance, float]].</span>
        <span class="c1"># For now, to satisfy Pylint and type checkers if the method were to return,</span>
        <span class="c1"># we can assign and then immediately handle the expected NotImplementedError.</span>
        <span class="c1"># However, a cleaner approach is to directly call and handle.</span>

        <span class="c1"># Attempt the call and handle NotImplementedError specifically.</span>
        <span class="c1"># Other GrizabellaExceptions or general Exceptions will be caught below.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># This line will raise NotImplementedError based on current client.py</span>
            <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span>
                <span class="nb">tuple</span><span class="p">[</span><span class="n">ObjectInstance</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">search_similar_objects</span><span class="p">(</span>
                <span class="n">object_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">,</span>
                <span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span>
                <span class="n">n_results</span><span class="o">=</span><span class="n">n_results</span><span class="p">,</span>
                <span class="n">search_properties</span><span class="o">=</span><span class="n">search_properties</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>  <span class="c1"># This line will not be reached if NotImplementedError is raised</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span> <span class="k">as</span> <span class="n">nie</span><span class="p">:</span>
            <span class="c1"># Specific handling for the known unimplemented feature.</span>
            <span class="c1"># Raising a general Exception here for the MCP layer is acceptable to signal this state.</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: search_similar_objects feature is not yet implemented in the Grizabella client: </span><span class="si">{</span><span class="n">nie</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">nie</span>

    <span class="k">except</span> <span class="n">GrizabellaException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle other Grizabella-specific errors, re-raise as GrizabellaException</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: Error searching similar objects for &#39;</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="n">GrizabellaException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
        <span class="c1"># Handle any other unexpected errors, re-raise as general Exception</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MCP: Unexpected error searching similar objects for &#39;</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="grizabella.mcp.server.shutdown_handler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shutdown_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Handle shutdown signals gracefully.</p>

            <details class="quote">
              <summary>Source code in <code>grizabella/mcp/server.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">shutdown_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle shutdown signals gracefully.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received signal </span><span class="si">{</span><span class="n">signum</span><span class="si">}</span><span class="s2">, shutting down...&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># sys.stderr might not be available during shutdown</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received signal </span><span class="si">{</span><span class="n">signum</span><span class="si">}</span><span class="s2">, shutting down...&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received signal </span><span class="si">{</span><span class="n">signum</span><span class="si">}</span><span class="s2">, shutting down...&quot;</span><span class="p">)</span>

    <span class="c1"># Perform forceful cleanup during signal handling to avoid async issues</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Stop monitoring first (sync)</span>
        <span class="n">stop_global_monitoring</span><span class="p">()</span>

        <span class="c1"># Force cleanup DB managers without async operations</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">grizabella.core.db_manager_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">_db_manager_factory</span>
        <span class="k">if</span> <span class="n">_db_manager_factory</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">_db_manager_factory</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">_db_manager_factory</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">_db_manager_factory</span><span class="o">.</span><span class="n">_reference_counts</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Force cleanup connection pools without async operations</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">grizabella.core.connection_pool</span><span class="w"> </span><span class="kn">import</span> <span class="n">_connection_pool_manager</span>
        <span class="k">if</span> <span class="n">_connection_pool_manager</span><span class="p">:</span>
            <span class="n">_connection_pool_manager</span><span class="o">.</span><span class="n">_shutdown</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">_connection_pool_manager</span><span class="o">.</span><span class="n">_cleanup_thread</span> <span class="ow">and</span> <span class="n">_connection_pool_manager</span><span class="o">.</span><span class="n">_cleanup_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="n">_connection_pool_manager</span><span class="o">.</span><span class="n">_cleanup_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">_connection_pool_manager</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">_connection_pool_manager</span><span class="o">.</span><span class="n">_connection_count</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Force cleanup completed during shutdown&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during force cleanup: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Exit immediately</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>